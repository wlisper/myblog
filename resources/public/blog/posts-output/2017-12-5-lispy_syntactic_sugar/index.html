<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
    <meta charset="utf-8"/>
    <title>Buddha says: Let there be Guns: lispy语法糖</title>
    <link rel="canonical" href="http://blogawesome.com/blog/posts-output/2017-12-5-lispy_syntactic_sugar/">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="//fonts.googleapis.com/css?family=Alegreya:400italic,700italic,400,700" rel="stylesheet"
          type="text/css">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.0/css/bootstrap.min.css">
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.7.0/styles/default.min.css">
    <link href="/blog/css/screen.css" rel="stylesheet" type="text/css" />
</head>
<body>


<nav class="navbar navbar-default">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/blog/">Buddha says: Let there be Guns</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
            <ul class="nav navbar-nav navbar-right">
                <li ><a href="/blog/">Home</a></li>
                <li
                ><a href="/blog/archives/">Archives</a></li>
                
                <li
                >
                <a href="/blog/pages-output/about/">About</a>
                </li>
                
                <li><a href="/blog/feed.xml">RSS</a></li>
            </ul>
        </div><!--/.nav-collapse -->
    </div><!--/.container-fluid -->
</nav>


<div class="container">


    <div class="row">
        <div class="col-lg-9">
            <div id="content">
                
<div id="post">
    <div class="post-header">
    <div id="post-meta" class="row">
        <div class="col-lg-6">December 5, 2017</div>
        
    </div>
    <h2>lispy语法糖</h2>
</div>
<div>
    
    <p><div id="table-of-contents"> <h2>Table of Contents</h2> <div id="text-table-of-contents"> <ul> <li><a href="#org258c079">1. lispy语法糖</a> <ul> <li><a href="#org747c3bc">1.1. c风格for循环</a></li> <li><a href="#orgc6362d0">1.2. c风格while循环</a></li> <li><a href="#org87c8956">1.3. php风格foreach</a></li> <li><a href="#org6bb79b5">1.4. php数组语法糖[]</a></li> <li><a href="#orgfe963ea">1.5. 字面hash</a></li> <li><a href="#orgab2fd74">1.6. @型注释</a></li> </ul> </li> </ul> </div> </div></p><p><a id="org258c079"></a></p><h1 id="lispy语法糖">lispy语法糖</h1><p>语法糖虽甜，吃多了可会长蛀牙，里面还有很多bug哦。</p><p><a id="org747c3bc"></a></p><h2 id="c风格for循环">c风格for循环</h2><p>lisp实现如下：</p><pre><code>&#40;defmacro for &#40;&#40;init cond step&#41; &amp;body body&#41;
  &#40;rutils:with-gensyms &#40;goto-tag exit-tag&#41;
    `&#40;let&#42; ,init
       &#40;tagbody
          ,goto-tag
           &#40;labels &#40;&#40;my-continue &#40;&#41;
                      ,step &#40;go ,goto-tag&#41;&#41;
                    &#40;my-break &#40;&#41; &#40;go ,exit-tag&#41;&#41;&#41;
             &#40;loop
                &#40;unless ,cond &#40;return&#41;&#41;
                ,@body
                ,step&#41;&#41;
          ,exit-tag&#41;&#41;&#41;&#41;

;; test
&#40;for &#40;&#40;&#40;i 0&#41;&#41; &#40;&lt; i 10&#41; &#40;incf i&#41;&#41;
    &#40;if &#40;= i 6&#41; &#40;my-break&#41;&#41;
    &#40;if &#40;evenp i&#41; &#40;my-continue&#41;&#41;
    &#40;format t &quot;&#126;A&#126;%&quot; i&#41;&#41;
;; output
;1
;3
;5</code></pre><p><a id="orgc6362d0"></a></p><h2 id="c风格while循环">c风格while循环</h2><p>lisp实现如下：</p><pre><code>&#40;defmacro while &#40;test &amp;body body&#41;
  `&#40;for &#40;&#40;&#41; ,test nil&#41;
     ,@body&#41;&#41;</code></pre><p><a id="org87c8956"></a></p><h2 id="php风格foreach">php风格foreach</h2><pre><code>&#40;defmacro foreach &#40;&#40;var seq&#41; &amp;body body&#41;
  &#40;rutils:with-gensyms &#40;seq-sym&#41;
    `&#40;let &#40;&#40;,seq-sym ,seq&#41;&#41;
       &#40;if &#40;listp ,seq-sym&#41;
           &#40;loop for ,var in ,seq-sym
              do &#40;progn ,@body&#41;&#41;
           &#40;loop for ,var across ,seq-sym
                do &#40;progn ,@body&#41;&#41;&#41;&#41;&#41;&#41;

;; 作用于数组
&#40;foreach &#40;var #&#40;1 2 3 4&#41;&#41;
  &#40;format t &quot;&#126;A&#126;%&quot; var&#41;&#41;
;; 作用于链表
&#40;foreach &#40;var '&#40;1 2 3 4&#41;&#41;
  &#40;format t &quot;&#126;A&#126;%&quot; var&#41;&#41;</code></pre><p><a id="org6bb79b5"></a></p><h2 id="php数组语法糖[]">php数组语法糖[]</h2><p>php可以这样构造数组：[1, 2, 3]。</p><p>lisp实现如下：</p><pre><code>&#40;set-macro-character #\&#93; &#40;get-macro-character #\&#41;&#41;&#41;
&#40;set-macro-character #\&#91; &#40;lambda &#40;stream char&#41;
                           &#40;declare &#40;ignore char&#41;&#41;
                           &#40;let&#42; &#40;&#40;lst &#40;read-delimited-list #\&#93; stream&#41;&#41;
                                  &#40;res &#40;make-array &#40;length lst&#41;&#41;&#41;&#41;
                             &#40;dotimes &#40;i &#40;length lst&#41;&#41;
                               &#40;setf &#40;aref res i&#41; &#40;elt lst i&#41;&#41;&#41;
                             res&#41;&#41;&#41;

;; 测试
;  输入:&#91;1 2 3&#93;   返回数组：#&#40;1 2 3&#41; 
;  输入:&#91;&quot;hello&quot; 3 &#91;1 2 3&#93;&#93;  返回嵌套数组:#&#40;&quot;hello&quot; 3 #&#40;1 2 3&#41;&#41;。</code></pre><p><a id="orgfe963ea"></a></p><h2 id="字面hash">字面hash</h2><p>很多语言都支持字面hash表,语法如下: {"key1" : value1, "key2" : value2};</p><p>lisp实现如下:</p><pre><code>&#40;set-macro-character #\} &#40;get-macro-character #\&#41;&#41;&#41;
&#40;set-macro-character #\{ &#40;lambda &#40;stream char&#41;
                           &#40;declare &#40;ignore char&#41;&#41;
                           &#40;let&#42; &#40;&#40;res &#40;make-hash-table&#41;&#41;
                                  &#40;lst &#40;read-delimited-list #\} stream&#41;&#41;&#41;
                             &#40;dolist &#40;pair lst&#41;
                               &#40;setf &#40;gethash &#40;car pair&#41; res&#41;
                                     &#40;cdr pair&#41;&#41;&#41;
                             res&#41;&#41;&#41;

;; 测试
; 输入{&#40;1 . 2&#41; &#40;3 . 4&#41; &#40;5 . 6&#41;}
; 返回哈希表</code></pre><p><a id="orgab2fd74"></a></p><h2 id="@型注释">@型注释</h2><p>例如：注册一个web控制器。 @controller public static void index() {<pre><code>// </code></pre>}</p><p>声明函数为内联。 @inline int fact(int n);</p><p>lisp实现如下：</p><pre><code>&#40;set-macro-character #\@ &#40;lambda &#40;stream char&#41;
                           &#40;declare &#40;ignore char&#41;&#41;
                           &#40;let &#40;&#40;sym &#40;read stream&#41;&#41;
                                 &#40;forms &#40;read stream&#41;&#41;&#41;
                             &#40;cond &#40;&#40;eq sym 'controller&#41;
                                    &#40;progn 
                                       &#40;format t &quot;register controller: &#126;A&#126;%&quot; &#40;second forms&#41;&#41;
                                       ;; you can do more controller register work here
                                        forms&#41;&#41;
                                   &#40;&#40;eq sym 'inline&#41;
                                    &#40;progn &#40;format t &quot;declaring inline: &#126;A&#126;%&quot; &#40;second forms&#41;&#41;&#41;
                                    `&#40;,&#40;first forms&#41; ,&#40;second forms&#41; ,&#40;third forms&#41;
                                       &#40;declare &#40;inline ,&#40;second forms&#41;&#41;&#41;
                                       ,@&#40;cdddr forms&#41;&#41;&#41;&#41;&#41;&#41;&#41;

;;; test
;; 控制器注释
@controller
&#40;defun index &#40;&#41;
  &#40;format t &quot;this is my home page&#126;%&quot;&#41;&#41;

;; 内联注释
@inline
&#40;defun square &#40;n&#41;
  &#40;&#42; n n&#41;&#41;</code></pre>
</div>

<div id="post-tags">
    <b>Tags: </b>
    
    <a href="/blog/tags-output/language/">language</a>
    
</div>


    <div id="prev-next">
        
        <a href="/blog/posts-output/2017-12-5-php_has_a_pipe/">&laquo; Php Has a Pipe</a>
        
        
        <a class="right" href="/blog/posts-output/2017-12-2-topologic_sorting/">拓扑排序 &raquo;</a>
        
    </div>

    


</div>

            </div>
        </div>

        <div class="col-md-3">
            <div id="sidebar">
                <h3>Links</h3>
                <ul id="links">
                    <li><a href="http://cryogenweb.org/docs/home.html">Cryogen Docs</a></li>
                    <li><a href="http://carmenla.me/blog/archives">Carmen's Blog</a></li>
                    
                    <li><a href="/blog/pages-output/another-page/">Another Page</a></li>
                    
                </ul>
                
                <div id="recent">
                    <h3>Recent Posts</h3>
                    <ul>
                        
                        <li><a href="/blog/posts-output/2017-12-5-php_has_a_pipe/">Php Has a Pipe</a></li>
                        
                        <li><a href="/blog/posts-output/2017-12-5-lispy_syntactic_sugar/">lispy语法糖</a></li>
                        
                        <li><a href="/blog/posts-output/2017-12-2-topologic_sorting/">拓扑排序</a></li>
                        
                    </ul>
                </div>
                
                
                <div id="tags">
                    <h3>Tags</h3>
                    <ul>
                        
                        <li><a href="/blog/tags-output/language/">language</a></li>
                        
                        <li><a href="/blog/tags-output/algorithm/">algorithm</a></li>
                        
                        <li><a href="/blog/tags-output/lisp/">lisp</a></li>
                        
                        <li><a href="/blog/tags-output/architecture/">architecture</a></li>
                        
                        <li><a href="/blog/tags-output/translate/">translate</a></li>
                        
                        <li><a href="/blog/tags-output/cryogen/">cryogen</a></li>
                        
                        <li><a href="/blog/tags-output/very fetch/">very fetch</a></li>
                        
                        <li><a href="/blog/tags-output/not fetch/">not fetch</a></li>
                        
                    </ul>
                </div>
                
            </div>
        </div>
    </div>
    <footer>Copyright &copy; 2018 佛说要有枪
        <p style="text-align: center;">Powered by <a href="http://cryogenweb.org">Cryogen</a></p></footer>
</div>
<script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.0/js/bootstrap.min.js"></script>
<script src="/blog/js/highlight.pack.js" type="text/javascript"></script>
<script>hljs.initHighlightingOnLoad();</script>


</body>
</html>
